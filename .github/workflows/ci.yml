name: Production CI/CD (Main Branch)

on:
  push:
    # main ë¸Œëœì¹˜ì— ì½”ë“œê°€ push/merge ë  ë•Œë§Œ ì‹¤í–‰
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ—„ï¸ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: "20" # í”„ë¡œì íŠ¸ì— ë§ëŠ” Node.js ë²„ì „ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”

      - name: ğŸ“¦ Install Dependencies
        run: npm install

      - name: ğŸ§ª Run Tests
        # í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ê°€ 'npm test'ì¸ ê²½ìš°
        run: npm test

      - name: ğŸ—ï¸ Build Project
        # ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ 'npm run build'ì¸ ê²½ìš°
        run: npm run build

      - name: ğŸš€ Deploy to Vercel Production
        uses: amondnet/vercel-action@v20
        with:
          # VERCEL_TOKEN, VERCEL_ORG_ID, VERCEL_PROJECT_IDëŠ” GitHub Secretsì— ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤.
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          github-token: ${{ secrets.GITHUB_TOKEN }} # ê¸°ë³¸ê°’, í•„ìš” ì‹œ í† í° ë“±ë¡í•©ë‹ˆë‹¤.
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          # main ë¸Œëœì¹˜ í‘¸ì‹œëŠ” Production ë°°í¬ë¡œ ì„¤ì • (prod: true)
          scope: production # Production ë°°í¬ì„ì„ ëª…ì‹œ (Vercel Actionì˜ íŒŒë¼ë¯¸í„°ì— ë”°ë¼ 'prod: true' ì˜µì…˜ì´ í•„ìš”í•œ ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.)
